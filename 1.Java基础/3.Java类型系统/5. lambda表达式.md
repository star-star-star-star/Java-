# lambda表达式的概念

lambda表达式以字面量的形式把少量代码直接写在程序中，而且让Java编程更符合函数式风格。

其实，lambda表达式的很多功能都可以使用嵌套类型通过回调和处理程序等模式实现，但使用的句法总是非常冗长，尤其是，就算只需要在回调中编写一行代码，也要完整定义一个新类型。

lambda表达式的句法是一个参数列表和方法主体，就像这样 `(p, q) -> {方法主体}` 。这种句法能通过十分紧凑的方式表示简单的方法，而且能很大程度上避免使用匿名类。

例如，java.io.File 类的 list() 方法。这个方法列出一个目录中的文件，但在返回列表之前，要把每个文件的名称传给 FilenameFilter 对象，而这个对象必须由你提供，该对象用于接受或拒绝各个文件。

使用匿名类可以按照如下的方式定义一个 FilenameFilter 类，只列出文件名以 .java 结尾的文件：

```java
File dir = new File("/src");    //列出这个目录中的文件
//调用 list() 方法，参数的值是一个使用匿名类实现的 FilenameFilter
String[] filelist = dir.list(new FilenameFilter() {
	public boolean accept(File f, String s) {
		return s.endsWith(".java");
	}
});
```

如果使用lambda表达式，上述代码可以简化为：

```java
File dir = new File("/src");
String[] filelist = dir.list((f, s) -> {return s.endsWith(".java");});
```

对目录中的每个文件来说，都会执行lambda表达式中的代码。如果这个方法的返回值是true，对应的文件就会出现在输出中，即存入数组 filelist 中。这种模式叫做“过滤器”，即使用一个代码块测试容器中的元素是否匹配某个条件，并且只返回能通过条件的元素，过滤器是函数式编程的标准技术之一。

# 转换lambda表达式

javac遇到lambda表达式时会把它解释为一个方法的主体，这个方法具有特定的签名。不过，是哪个方法呢？为了解决这个问题，javac会查看周围的代码。lambda表达式必须满足以下条件才算是合法的java代码：
+ lambda表达式必须出现在期望使用接口类型实例的地方；
+ 期望使用的接口类型必须只有一个强制方法，这个强制方法的签名要完全匹配lambda表达式。

如果满足上述条件，编译器会创建一个类型，实现期望使用的接口，然后把lambda表达式的主体当作强制方法的实现。说的稍微复杂一些，这么做是为了保持Java类型系统的名义（基于名称）纯粹性。也就是说，lambda表达式会被转换成正确接口类型的实例。

有些开发者还喜欢使用“单一抽象方法”（Single Abstract Method，SAM）类型这个术语表示lambda表达式转换得到的接口类型。这表明，若想在lambda表达式机制中使用某个接口，这个接口必须只有一个非默认方法。

tip：虽然lambda表达式和匿名类有很多相似之处，但lambda表达式并不只是匿名类的语法糖。其实，lambda表达式使用方法句柄和一个特殊的新JVM字节码 invokedynamic 实现。

# 方法引用

前面说过，可以把lambda表达式看成没有名称的方法。对下面的lambda表达式来说：

```java
//实际上这行代码可以写得更短，因为有类型推导
(MyObject myobj) -> myobj.toString()
```

会自动转换成对 @FunctionalInterface 接口的实现，这个接口只有一个非默认方法，这个方法接受一个 MyObject 类型的参数，返回值类型为 String。不过，这样的样板代码太多，所以 Java 8 提供了一种句法，可以让这种lambda表达式更易于阅读和编写：

```java
MyObject::toString
```

这种简写形式叫方法引用（method reference），使用现有的方法，但会忽略方法的名称，所以能作为lambda表达式使用，而且能使用往常的方式自动转换。

# 函数式编程

Java实质上是面向对象的语言，不过，引入lambda表达式后，可以更轻易地编写符合函数式风格的代码。

tip：关于函数式语言由什么组成，没有明确的定义，但至少有一个共识：函数式语言最起码要能把函数当成值，存入变量。

Java一直能够通过内部类表示函数，但句法复杂，代码结构不清晰。lambda表达式大大简化了这种句法，因此，越来越多的开发者会在Java代码中寻求使用函数式编程风格，这是很自然的，而且现在做起来也更容易。

Java开发者初次尝试函数式编程时可能会使用如下三个非常有用的基本习语：
+ `map()` ：用于列表和类似列表的容器。运作原理是，传入一个函数，应用于集合中的各个元素，得到一个新集合。新集合中保存的是在各个元素上执行函数后得到的结果。这意味着 map() 可能会把一种类型的集合转换成另一种类型的集合。
+ `filter()` ：基于某种条件生成一个集合的子集。注意，在函数式编程中，一般会生成新的集合，而不直接修改现有的集合。
+ `reduce()` ：执行的是聚合运算，有多种不同的形式，除了叫“化简”之外，还可以叫做“合拢”“累计”或“聚合”。基本原理是，提供一个初始值和聚合函数（或化简函数），然后在各个元素上执行这个化简函数，在化简函数遍历整个集合的过程中会得到一些列中间值（类似于“累积计数”），最后得到一个最终的结果。

Java完全支持这些重要的函数式习语（除此之外还有几个习语），抽象流是实现这些习语的基础。
